{
  "openapi": "3.0.3",
  "info": {
    "title": "Express API Template",
    "version": "0.0.1",
    "description": "RESTful API for todo management with JWT authentication"
  },
  "servers": [
    {
      "url": "http://localhost:3000/api",
      "description": "Development server"
    }
  ],
  "tags": [
    {
      "name": "Authentication",
      "description": "User authentication and token management"
    },
    {
      "name": "Todos",
      "description": "Todo CRUD operations"
    }
  ],
  "security": [
    {
      "AccessToken": []
    }
  ],
  "paths": {
    "/auth/signup": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Create user account",
        "description": "Register a new user account with username and password",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SignupRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "$ref": "#/components/responses/Created"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/auth/signin": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Sign in user",
        "description": "Authenticate with credentials and receive access/refresh tokens",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SigninRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/SigninSuccess"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Refresh access token",
        "description": "Get a new access token using a valid refresh token",
        "security": [
          {
            "RefreshToken": []
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/RefreshSuccess"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/todos": {
      "get": {
        "tags": ["Todos"],
        "summary": "Get all todos",
        "description": "Retrieve paginated list of todos for the authenticated user",
        "parameters": [
          {
            "$ref": "#/components/parameters/PaginationPage"
          },
          {
            "$ref": "#/components/parameters/PaginationLimit"
          },
          {
            "$ref": "#/components/parameters/SortBy"
          },
          {
            "$ref": "#/components/parameters/SortOrder"
          },
          {
            "$ref": "#/components/parameters/Search"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/TodosList"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "post": {
        "tags": ["Todos"],
        "summary": "Create todo",
        "description": "Create a new todo for the authenticated user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateTodoRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "$ref": "#/components/responses/TodoCreated"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "delete": {
        "tags": ["Todos"],
        "summary": "Delete multiple todos",
        "description": "Delete multiple todos by comma-separated IDs",
        "parameters": [
          {
            "name": "ids",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Comma-separated list of todo IDs to delete",
            "example": "550e8400-e29b-41d4-a716-446655440000,550e8400-e29b-41d4-a716-446655440001"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/OK"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/todos/{todo_id}": {
      "get": {
        "tags": ["Todos"],
        "summary": "Get single todo",
        "description": "Retrieve a specific todo by ID",
        "parameters": [
          {
            "$ref": "#/components/parameters/TodoIdParam"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/TodoSingle"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "put": {
        "tags": ["Todos"],
        "summary": "Update todo",
        "description": "Update a specific todo by ID",
        "parameters": [
          {
            "$ref": "#/components/parameters/TodoIdParam"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateTodoRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/TodoSingle"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "delete": {
        "tags": ["Todos"],
        "summary": "Delete single todo",
        "description": "Delete a specific todo by ID",
        "parameters": [
          {
            "$ref": "#/components/parameters/TodoIdParam"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/OK"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "AccessToken": {
        "type": "apiKey",
        "in": "header",
        "name": "x-access-token",
        "description": "JWT access token for authenticated requests (expires in 15 minutes)"
      },
      "RefreshToken": {
        "type": "apiKey",
        "in": "header",
        "name": "x-refresh-token",
        "description": "JWT refresh token for obtaining new access tokens (expires in 7 days)"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "User unique identifier"
          },
          "username": {
            "type": "string",
            "minLength": 5,
            "description": "Unique username"
          }
        },
        "required": ["id", "username"]
      },
      "Todo": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "user_id": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "is_completed": {
            "type": "boolean"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["id", "user_id", "title", "is_completed", "created_at", "updated_at"]
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "current_page": {
            "type": "integer",
            "minimum": 1
          },
          "total_pages": {
            "type": "integer",
            "minimum": 0
          },
          "total_items": {
            "type": "integer",
            "minimum": 0
          },
          "items_per_page": {
            "type": "integer",
            "minimum": 1
          },
          "has_next_page": {
            "type": "boolean"
          },
          "has_previous_page": {
            "type": "boolean"
          },
          "next_page": {
            "type": "integer",
            "nullable": true
          },
          "previous_page": {
            "type": "integer",
            "nullable": true
          }
        },
        "required": [
          "current_page",
          "total_pages",
          "total_items",
          "items_per_page",
          "has_next_page",
          "has_previous_page",
          "next_page",
          "previous_page"
        ]
      },
      "StandardResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object",
            "nullable": true
          }
        },
        "required": ["message"]
      },
      "Error": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "error": {
            "type": "string"
          }
        },
        "required": ["message"]
      },
      "SignupRequest": {
        "type": "object",
        "properties": {
          "username": {
            "type": "string",
            "minLength": 5,
            "description": "Unique username (minimum 5 characters)"
          },
          "password": {
            "type": "string",
            "minLength": 8,
            "description": "Password (minimum 8 characters)"
          }
        },
        "required": ["username", "password"]
      },
      "SigninRequest": {
        "type": "object",
        "properties": {
          "username": {
            "type": "string",
            "minLength": 5
          },
          "password": {
            "type": "string",
            "minLength": 8
          }
        },
        "required": ["username", "password"]
      },
      "SigninResponseData": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "username": {
            "type": "string"
          },
          "access_token": {
            "type": "string",
            "description": "JWT access token"
          },
          "refresh_token": {
            "type": "string",
            "description": "JWT refresh token"
          }
        },
        "required": ["id", "username", "access_token", "refresh_token"]
      },
      "RefreshResponseData": {
        "type": "object",
        "properties": {
          "access_token": {
            "type": "string",
            "description": "New JWT access token"
          }
        },
        "required": ["access_token"]
      },
      "CreateTodoRequest": {
        "type": "object",
        "properties": {
          "title": {
            "type": "string",
            "description": "Todo title"
          },
          "description": {
            "type": "string",
            "description": "Optional description"
          },
          "is_completed": {
            "type": "boolean",
            "description": "Completion status"
          }
        },
        "required": ["title"]
      },
      "UpdateTodoRequest": {
        "type": "object",
        "properties": {
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "is_completed": {
            "type": "boolean"
          }
        },
        "required": ["title"]
      },
      "TodosListData": {
        "type": "object",
        "properties": {
          "todos": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Todo"
            }
          },
          "pagination": {
            "$ref": "#/components/schemas/Pagination"
          }
        },
        "required": ["todos", "pagination"]
      },
      "TodoSingleData": {
        "type": "object",
        "properties": {
          "todo": {
            "$ref": "#/components/schemas/Todo"
          }
        },
        "required": ["todo"]
      },
      "UserData": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "username": {
            "type": "string"
          }
        },
        "required": ["id", "username"]
      }
    },
    "parameters": {
      "TodoIdParam": {
        "name": "todo_id",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        },
        "description": "UUID of the todo",
        "example": "550e8400-e29b-41d4-a716-446655440000"
      },
      "PaginationPage": {
        "name": "page",
        "in": "query",
        "schema": {
          "type": "integer",
          "minimum": 1,
          "default": 1
        },
        "description": "Page number for pagination"
      },
      "PaginationLimit": {
        "name": "limit",
        "in": "query",
        "schema": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 10
        },
        "description": "Number of items per page"
      },
      "SortBy": {
        "name": "sort_by",
        "in": "query",
        "schema": {
          "type": "string",
          "enum": ["updated_at", "title"],
          "default": "updated_at"
        },
        "description": "Field to sort by"
      },
      "SortOrder": {
        "name": "sort_order",
        "in": "query",
        "schema": {
          "type": "string",
          "enum": ["asc", "desc"],
          "default": "desc"
        },
        "description": "Sort order"
      },
      "Search": {
        "name": "search",
        "in": "query",
        "schema": {
          "type": "string",
          "maxLength": 255,
          "default": ""
        },
        "description": "Search term to filter results by title (case-insensitive)"
      }
    },
    "responses": {
      "OK": {
        "description": "Request successful",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/StandardResponse"
            }
          }
        }
      },
      "Created": {
        "description": "Resource created successfully",
        "content": {
          "application/json": {
            "schema": {
              "allOf": [
                {
                  "$ref": "#/components/schemas/StandardResponse"
                },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/UserData"
                    }
                  }
                }
              ]
            },
            "example": {
              "message": "Created",
              "data": {
                "id": "550e8400-e29b-41d4-a716-446655440000",
                "username": "johndoe"
              }
            }
          }
        }
      },
      "SigninSuccess": {
        "description": "Authentication successful",
        "content": {
          "application/json": {
            "schema": {
              "allOf": [
                {
                  "$ref": "#/components/schemas/StandardResponse"
                },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/SigninResponseData"
                    }
                  }
                }
              ]
            },
            "example": {
              "message": "OK",
              "data": {
                "id": "550e8400-e29b-41d4-a716-446655440000",
                "username": "johndoe",
                "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              }
            }
          }
        }
      },
      "RefreshSuccess": {
        "description": "Token refreshed successfully",
        "content": {
          "application/json": {
            "schema": {
              "allOf": [
                {
                  "$ref": "#/components/schemas/StandardResponse"
                },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/RefreshResponseData"
                    }
                  }
                }
              ]
            },
            "example": {
              "message": "OK",
              "data": {
                "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              }
            }
          }
        }
      },
      "TodosList": {
        "description": "Todos retrieved successfully",
        "content": {
          "application/json": {
            "schema": {
              "allOf": [
                {
                  "$ref": "#/components/schemas/StandardResponse"
                },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/TodosListData"
                    }
                  }
                }
              ]
            }
          }
        }
      },
      "TodoCreated": {
        "description": "Todo created successfully",
        "content": {
          "application/json": {
            "schema": {
              "allOf": [
                {
                  "$ref": "#/components/schemas/StandardResponse"
                },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/TodoSingleData"
                    }
                  }
                }
              ]
            }
          }
        }
      },
      "TodoSingle": {
        "description": "Todo retrieved successfully",
        "content": {
          "application/json": {
            "schema": {
              "allOf": [
                {
                  "$ref": "#/components/schemas/StandardResponse"
                },
                {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/TodoSingleData"
                    }
                  }
                }
              ]
            }
          }
        }
      },
      "BadRequest": {
        "description": "Invalid request data",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "validation": {
                "summary": "Validation error",
                "value": {
                  "message": "\"username\" length must be at least 5 characters long"
                }
              },
              "duplicate": {
                "summary": "Duplicate user",
                "value": {
                  "message": "user with the given username already exists"
                }
              }
            }
          }
        }
      },
      "Unauthorized": {
        "description": "Authentication required or invalid credentials",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "noToken": {
                "summary": "No token provided",
                "value": {
                  "message": "No token provided"
                }
              },
              "invalid": {
                "summary": "Invalid token",
                "value": {
                  "message": "Invalid token"
                }
              },
              "expired": {
                "summary": "Token expired",
                "value": {
                  "message": "Token expired"
                }
              },
              "credentials": {
                "summary": "Invalid credentials",
                "value": {
                  "message": "invalid credentials"
                }
              }
            }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "message": "Not Found"
            }
          }
        }
      }
    }
  }
}
